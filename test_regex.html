<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>測試正則表達式</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        .test-case {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-case h3 {
            margin-top: 0;
            color: #333;
        }
        .input {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            font-family: monospace;
        }
        .result {
            background: #e8f5e9;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
        }
        .result.fail {
            background: #ffebee;
        }
        .matches {
            color: #2196F3;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>BOM表零件編號識別測試</h1>

    <div id="results"></div>

    <script>
        // 測試正則表達式
        function testRegex() {
            const testCases = [
                {
                    name: "逗號分隔的零件列表",
                    text: "C47,C51,C52,C56",
                    expected: ["C47", "C51", "C52", "C56"]
                },
                {
                    name: "空格分隔的零件列表",
                    text: "R1 R2 R3 R5",
                    expected: ["R1", "R2", "R3", "R5"]
                },
                {
                    name: "混合分隔符",
                    text: "C1, C2 C3|C5",
                    expected: ["C1", "C2", "C3", "C5"]
                },
                {
                    name: "括號內的零件",
                    text: "(C10,C15,C20)",
                    expected: ["C10", "C15", "C20"]
                },
                {
                    name: "帶值的零件",
                    text: "C47: 560u, C51: 560u, C52: 560u",
                    expected: ["C47", "C51", "C52"]
                },
                {
                    name: "表格格式",
                    text: "C1-100u C2-220u C3-470u",
                    expected: ["C1", "C2", "C3"]
                },
                {
                    name: "多行文本",
                    text: "零件清單:\nC1, C2, C3\nR1, R2, R3\nL1, L2",
                    expected: ["C1", "C2", "C3", "R1", "R2", "R3", "L1", "L2"]
                },
                {
                    name: "BOM表實際格式",
                    text: "編號 規格\nC47 560u(相同:C51,C52,C56)\nR10 10kΩ",
                    expected: ["C47", "C51", "C52", "C56", "R10"]
                }
            ];

            const resultsDiv = document.getElementById('results');
            const componentPattern = /([A-Z]{1,3})(\d{1,4})(?=[,\s\.\|;:\-\)]|$)/g;

            testCases.forEach((testCase, index) => {
                const matches = [];
                let match;
                const regex = new RegExp(componentPattern);

                while ((match = regex.exec(testCase.text)) !== null) {
                    matches.push(match[1] + match[2]);
                }

                const passed = JSON.stringify(matches) === JSON.stringify(testCase.expected);

                const div = document.createElement('div');
                div.className = 'test-case';
                div.innerHTML = `
                    <h3>測試 ${index + 1}: ${testCase.name} ${passed ? '✅' : '❌'}</h3>
                    <div class="input"><strong>輸入文字:</strong><br>${testCase.text}</div>
                    <div class="result ${passed ? '' : 'fail'}">
                        <strong>識別結果:</strong> <span class="matches">${matches.join(', ')}</span><br>
                        <strong>預期結果:</strong> ${testCase.expected.join(', ')}<br>
                        <strong>數量:</strong> 找到 ${matches.length} 個，預期 ${testCase.expected.length} 個
                    </div>
                `;
                resultsDiv.appendChild(div);
            });

            // 總結
            const summary = document.createElement('div');
            summary.style.cssText = 'margin-top: 30px; padding: 20px; background: #2196F3; color: white; border-radius: 5px;';
            summary.innerHTML = `
                <h2>測試完成</h2>
                <p>正則表達式: <code>/([A-Z]{1,3})(\\d{1,4})(?=[,\\s\\.\\|;:\\-\\)]|$)/g</code></p>
                <p>此正則可以正確識別各種分隔符（逗號、空格、點、管線、分號、冒號、破折號、括號）分隔的零件編號</p>
            `;
            resultsDiv.appendChild(summary);
        }

        // 執行測試
        testRegex();
    </script>
</body>
</html>
