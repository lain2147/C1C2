# Google Vision API 設定指南

## 📝 功能說明

本工具現已整合 **Google Cloud Vision API**，提供：
- ✅ **高精度 OCR 辨識**：辨識準確度大幅提升
- ✅ **快速處理**：比 Tesseract.js 更快
- ✅ **預處理選項**：可自由調整圖片預處理步驟
- ✅ **手動輸入**：支援手動添加零件編號
- ✅ **混合統計**：OCR 和手動輸入結果合併統計

---

## 🔑 取得 Google Vision API Key

### 步驟 1：啟用 Google Cloud Vision API

1. 前往 [Google Cloud Console](https://console.cloud.google.com/)
2. 創建新專案或選擇現有專案
3. 導航至「API 和服務」>「資料庫」
4. 搜尋「Cloud Vision API」並點擊「啟用」

### 步驟 2：創建 API Key

1. 前往「API 和服務」>「憑證」
2. 點擊「+ 建立憑證」>「API 金鑰」
3. 複製生成的 API Key

### 步驟 3：設定 API Key 限制（重要！）

為了安全性，建議設定以下限制：

#### 應用程式限制：
- **HTTP referrer**：限制只能從特定網域使用
  - 例如：`https://yourdomain.com/*`
  - 本地測試：`http://localhost/*` 或 `file:///*`

#### API 限制：
- 選擇「限制金鑰」
- 只勾選「Cloud Vision API」

### 步驟 4：設定配額和計費

1. 前往「IAM 與管理」>「配額」
2. 查看 Vision API 的免費配額
3. **免費額度**：每月前 1,000 個請求免費
4. 超過後按使用量計費（參考 [定價說明](https://cloud.google.com/vision/pricing)）

---

## 🚀 使用方法

### 1. 選擇 OCR 引擎

在工具介面中：
- ✅ **Google Cloud Vision API（推薦）**：高精度、快速
  - 需要網路連線
  - 需要有效的 API Key
- ⭕ **Tesseract.js（離線）**：完全離線、免費
  - 速度較慢
  - 準確度較低

### 2. 輸入 API Key

1. 選擇「Google Cloud Vision API」
2. 在輸入框中貼上您的 API Key
3. 點擊「測試 API Key」按鈕驗證

### 3. 調整預處理選項

根據圖片品質選擇：
- ✅ **自動矯正傾斜角度**：圖片有傾斜時勾選
- ✅ **壓縮大圖片（>2MB）**：圖片太大時勾選
- ✅ **二值化處理**：提升辨識率（推薦）
- ✅ **增強對比度和灰度化**：圖片模糊時勾選

**提示：** 如果圖片品質很好且正確擺放，可取消部分預處理以加快速度

### 4. 手動輸入零件編號

如果有其他來源的零件清單：
1. 在「手動輸入零件編號」區域貼上文字
2. 支援格式：
   ```
   C1, C2, C3, C5
   R10 R11 R15
   L1|L2|L3
   D5, D7, D8
   ```
3. 點擊「加入零件編號」
4. 系統會自動解析並合併到統計結果

### 5. 開始辨識

1. 上傳圖片或拍照
2. 點擊「開始辨識」
3. 等待處理完成
4. 查看結果和統計
5. 匯出 Excel 報表

---

## 📊 結果說明

### 零件標籤顏色：
- **紫色**：OCR 辨識的零件
- **綠色（✏️）**：手動輸入的零件
- **藍色**：具有相同規格的零件

### 統計資訊：
- **已處理圖片**：OCR 辨識的圖片數量
- **零件總數**：包含 OCR + 手動輸入
- **唯一零件數**：去重後的數量

---

## ⚠️ 安全提醒

### API Key 安全：
1. **不要公開分享** API Key
2. **設定使用限制**：HTTP referrer 或 IP 限制
3. **定期檢查使用量**：避免超支
4. **撤銷洩漏的 Key**：如果不小心公開，立即撤銷並重新生成

### 最佳實踐：
```javascript
// 不要在公開的程式碼中硬編碼 API Key
const apiKey = 'YOUR_API_KEY_HERE'; // ❌ 錯誤

// 應該使用環境變數或配置文件
const apiKey = process.env.GOOGLE_VISION_API_KEY; // ✅ 正確
```

---

## 🐛 常見問題

### Q1：API Key 無效
**A：**
- 確認 API Key 已正確複製
- 檢查 Vision API 是否已啟用
- 檢查 API Key 的限制設定

### Q2：請求失敗（403 Forbidden）
**A：**
- 檢查 HTTP referrer 限制
- 確認從允許的網域訪問
- 本地測試時可能需要暫時移除限制

### Q3：超過免費配額
**A：**
- 每月前 1,000 個請求免費
- 查看 Google Cloud Console 的計費頁面
- 考慮設定預算警報

### Q4：辨識結果不準確
**A：**
- 嘗試調整預處理選項
- 確保圖片清晰、光線充足
- 檢查圖片角度是否正確

### Q5：如何在離線環境使用？
**A：**
- 選擇「Tesseract.js（離線）」選項
- 不需要 API Key
- 完全在瀏覽器本地運行

---

## 💰 成本估算

### 免費額度：
- 每月前 **1,000 個 DOCUMENT_TEXT_DETECTION 請求** 免費

### 付費價格（超過免費額度後）：
- $1.50 / 1,000 個請求（1,001 - 5,000,000）
- $0.60 / 1,000 個請求（5,000,001+）

### 範例計算：
- 處理 100 張圖片 = 100 個請求（免費）
- 處理 2,000 張圖片 = 2,000 個請求
  - 前 1,000 免費
  - 後 1,000 = $1.50

詳細定價：https://cloud.google.com/vision/pricing

---

## 📞 支援

如遇問題，請檢查：
1. 瀏覽器控制台的錯誤訊息
2. Google Cloud Console 的錯誤日誌
3. API 使用量儀表板

---

## 🎉 功能比較

| 功能 | Google Vision API | Tesseract.js |
|------|-------------------|--------------|
| 辨識準確度 | ⭐⭐⭐⭐⭐ 非常高 | ⭐⭐⭐ 中等 |
| 處理速度 | ⭐⭐⭐⭐⭐ 很快 | ⭐⭐ 較慢 |
| 離線使用 | ❌ 需要網路 | ✅ 完全離線 |
| 成本 | 💰 有限免費 | ✅ 完全免費 |
| 設定難度 | ⭐⭐⭐ 需要 API Key | ⭐ 簡單 |

**建議：**
- 日常使用：Google Vision API（準確度高）
- 離線環境：Tesseract.js（無網路需求）
- 大量處理：注意成本，可搭配使用

---

祝您使用愉快！如有任何問題，歡迎回饋。
